# DecentraLabs Lab Gateway - Full Version Environment Configuration
# This file contains all environment variables for the full version with auth2 service

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================

# Server configuration
SERVER_NAME=sarlab.dia.uned.es
BASE_DOMAIN=https://sarlab.dia.uned.es
HTTPS_PORT=443
HTTP_PORT=80

# =============================================================================
# MYSQL DATABASE CONFIGURATION
# =============================================================================

MYSQL_ROOT_PASSWORD=root_password_here
MYSQL_DATABASE=guacamole_db
MYSQL_USER=guacamole_user
MYSQL_PASSWORD=some_password

# =============================================================================
# GUACAMOLE CONFIGURATION
# =============================================================================

GUAC_ADMIN_USER=guacadmin
GUAC_ADMIN_PASS=guacadmin
ISSUER=DecentraLabsGateway

# =============================================================================
# AUTO-LOGOUT CONFIGURATION
# =============================================================================
# Automatically logout manual login users when RDP/VNC/SSH session disconnects
# Set to 'true' to enable, 'false' to disable
# Note: This only affects manual login users (not JWT-based marketplace users)
# and excludes the admin user (guacadmin)
AUTO_LOGOUT_ON_DISCONNECT=false

# =============================================================================
# BLOCKCHAIN SERVICE CONFIGURATION
# =============================================================================

# Smart Contract Configuration
CONTRACT_ADDRESS=0xYourDiamondContractAddress

# Legacy RPC_URL (fallback only - prefer network-specific URLs below)
# This is used when network-specific URL is not available
RPC_URL=https://1rpc.io/sepolia

# Institutional Wallet - used for ALL automated transactions
# (event listener confirmations, treasury operations, admin actions)
# To create: docker exec blockchain-services curl -X POST http://localhost:8080/wallet/create \
#   -H "Content-Type: application/json" -d '{"password":"YourSecurePassword"}'
# Then copy the address and configure these variables:
INSTITUTIONAL_WALLET_ADDRESS=
INSTITUTIONAL_WALLET_PASSWORD=

# Wallet Persistence and Encryption
# SECURITY: Change WALLET_ENCRYPTION_SALT to a random value in production
WALLET_ENCRYPTION_SALT=ChangeThisInProduction_RandomString32Chars
WALLET_PERSISTENCE_ENABLED=true
WALLET_FILE_PATH=/app/data/wallets.json

# JWT Key Paths (keep defaults unless mounting elsewhere)
PRIVATE_KEY_PATH=/app/config/keys/private_key.pem
PUBLIC_KEY_PATH=/app/config/keys/public_key.pem
PUBLIC_CERTIFICATE_PATH=/app/config/keys/certificate.pem

# Network-Specific RPC URLs (with automatic failover)
# Format: comma-separated list of RPC endpoints
# The service will try each URL in order until one succeeds
# Recommended: Mix free public endpoints with paid services for reliability
ETHEREUM_MAINNET_RPC_URL=https://eth.public-rpc.com
ETHEREUM_SEPOLIA_RPC_URL=https://1rpc.io/sepolia,https://rpc.sepolia.org,https://rpc2.sepolia.org,https://ethereum-sepolia-rpc.publicnode.com,https://eth-sepolia.g.alchemy.com/v2/demo

# SAML/SSO Configuration
# trust-mode: 'any' (trust all IdPs) or 'whitelist' (only trust listed IdPs)
SAML_IDP_TRUST_MODE=any
# Trusted IdPs (only used if trust-mode=whitelist)
# Format: {'institutionId':'idpIssuerUrl','id2':'url2'}
SAML_TRUSTED_IDP={'uned':'https://idp.uned.es','ucm':'https://idp.ucm.es'}

# Feature Toggles
FEATURES_PROVIDERS_ENABLED=true

# Anti-Replay Protection (for multiple service instances)
ANTIREPLAY_PERSISTENCE_ENABLED=false

# =============================================================================
# SECURITY / API CONFIGURATION
# =============================================================================

# CORS Configuration (comma-separated origins)
ALLOWED_ORIGINS=http://localhost:3000,https://marketplace-decentralabs.vercel.app

# Marketplace JWT Validation
MARKETPLACE_PUBLIC_KEY_URL=https://marketplace-decentralabs.vercel.app/.well-known/public-key.pem

# Logging Levels (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL_AUTH=INFO
LOG_LEVEL_SECURITY=WARN
LOG_LEVEL_WEB=WARN

# Performance Tuning
TOMCAT_MAX_THREADS=200
TOMCAT_MIN_THREADS=10

# JPA Configuration
JPA_DDL_AUTO=validate
JPA_SHOW_SQL=false

# =============================================================================
# DEVELOPMENT/PRODUCTION OVERRIDES
# =============================================================================

# Uncomment for development
# LOG_LEVEL_AUTH=DEBUG
# LOG_LEVEL_SECURITY=DEBUG
# LOG_LEVEL_WEB=DEBUG
# JPA_SHOW_SQL=true

# =============================================================================
# SECURITY CHECKLIST FOR PRODUCTION
# =============================================================================

# CRITICAL - Must Change:
# âœ… 1. WALLET_ENCRYPTION_SALT - Generate random 32+ character string
# âœ… 2. CONTRACT_ADDRESS - Your deployed Diamond contract address
# âœ… 3. WALLET_PRIVATE_KEY - Real wallet with gas funds (NEVER commit to git)
# âœ… 4. MYSQL_ROOT_PASSWORD and MYSQL_PASSWORD - Strong unique passwords
# âœ… 5. ETHEREUM_SEPOLIA_RPC_URL - Add your Infura/Alchemy API key

# Important - Review:
# ðŸ“‹ 6. ETHEREUM_SEPOLIA_RPC_URL - Consider paid RPC for production reliability
# ðŸ“‹ 7. ALLOWED_ORIGINS - Update with your actual frontend domains
# ðŸ“‹ 8. SSL Certificates - Ensure valid certs in ./certs/ directory
# ðŸ“‹ 9. INSTITUTIONAL_WALLET_* - Create if using Treasury operations
# ðŸ“‹ 10. Backup Strategy - Set up automated backups for MySQL and blockchain-data/

# Recommended - Optimize:
# ðŸ”§ 11. LOG_LEVEL_* - Set to INFO or WARN in production (not DEBUG)
# ðŸ”§ 12. TOMCAT_MAX_THREADS - Adjust based on your server resources
# ðŸ”§ 13. SAML_IDP_TRUST_MODE - Use 'whitelist' for better security
# ðŸ”§ 14. Monitor resource usage and adjust docker-compose.yml limits
# ðŸ”§ 15. Implement log rotation and monitoring/alerting

# Quick RPC Setup Guide:
# - Free Tier Infura: https://infura.io (100k requests/day)
# - Free Tier Alchemy: https://alchemy.com (300M compute units/month)
# - Use format: https://sepolia.infura.io/v3/YOUR_PROJECT_ID
# - Or keep multiple public RPCs for fallback (comma-separated)
